# ğŸ”„ Ø¯Ù„ÙŠÙ„ Return URL - Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©

## âœ… ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Return URL Ø¨Ø§Ù„ÙƒØ§Ù…Ù„!

Ø§Ù„Ø¢Ù† Ø¹Ù†Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ù† Ø£ÙŠ ØµÙØ­Ø©ØŒ Ø³ÙŠØ¹ÙˆØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù†ÙØ³ Ø§Ù„ØµÙØ­Ø© ÙˆÙ„ÙŠØ³ Ù„Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯!

---

## ğŸ¯ ÙƒÙŠÙ ÙŠØ¹Ù…Ù„ Ø§Ù„Ù†Ø¸Ø§Ù…

### Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ÙƒØ§Ù…Ù„:

```
ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØªØµÙØ­: /contact
   â†“
ğŸ” ÙŠØ¶ØºØ· "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„" ÙÙŠ Header
   â†“
ğŸ”— ÙŠØ°Ù‡Ø¨ Ø¥Ù„Ù‰: /login?return=/contact
   â†“
ğŸ“ ÙŠØ³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ (OAuth/Email/Phone)
   â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Ø¥Ø°Ø§ Ù…ÙˆØ«Ù‚ âœ…     â”‚ Ø¥Ø°Ø§ ØºÙŠØ± Ù…ÙˆØ«Ù‚ âš ï¸ â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚ ÙŠØ¹ÙˆØ¯ Ù…Ø¨Ø§Ø´Ø±Ø©     â”‚ ÙŠØ°Ù‡Ø¨ Ø¥Ù„Ù‰        â”‚
   â”‚ Ø¥Ù„Ù‰: /contact   â”‚ /auth/verify    â”‚
   â”‚                 â”‚ ?return=/contactâ”‚
   â”‚                 â”‚ â†“ (ÙŠÙˆØ«Ù‚ Ø­Ø³Ø§Ø¨Ù‡) â”‚
   â”‚                 â”‚ ÙŠØ¹ÙˆØ¯: /contact  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
        ğŸ‰ Ø§Ù„Ù†ØªÙŠØ¬Ø©: /contact
```

---

## ğŸ“ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ÙØ­Ø¯Ø«Ø©

### 1. `src/pages/login.tsx`
```typescript
// ÙÙŠ handleEmailLogin():
const returnUrl = getReturn(router);
if (!d.isVerified) {
  router.replace(`/auth/verify?return=${encodeURIComponent(returnUrl)}`);
} else {
  router.replace(returnUrl); // â† ÙŠØ¹ÙˆØ¯ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©!
}

// ÙÙŠ verifyOtp():
// Ù†ÙØ³ Ø§Ù„Ù…Ù†Ø·Ù‚

// ÙÙŠ handleSocialLogin():
// Ø­ÙØ¸ return URL ÙÙŠ localStorage Ù‚Ø¨Ù„ OAuth redirect
localStorage.setItem('oauth_return_url', returnUrl);
```

### 2. `src/pages/auth/oauth-success.tsx`
```typescript
// Ù‚Ø±Ø§Ø¡Ø© return URL Ù…Ù† localStorage
const returnUrl = localStorage.getItem('oauth_return_url') || '/dashboard';
localStorage.removeItem('oauth_return_url');

if (!userData.isVerified) {
  router.replace(`/auth/verify?return=${encodeURIComponent(returnUrl)}`);
} else {
  router.replace(returnUrl); // â† ÙŠØ¹ÙˆØ¯ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©!
}
```

### 3. `src/pages/auth/verify.tsx`
```typescript
// Ø¨Ø¹Ø¯ Ø§Ù„ØªÙˆØ«ÙŠÙ‚:
const returnUrl = (router.query.return as string) || '/dashboard';
router.replace(returnUrl); // â† ÙŠØ¹ÙˆØ¯ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©!

// Ø²Ø± "Ø§Ù„Ø¹ÙˆØ¯Ø©":
<InstantLink href={(router.query.return as string) || "/dashboard"}>
  {(router.query.return as string) 
    ? "Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©" 
    : "Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯"}
</InstantLink>
```

### 4. `src/components/layout/Header.tsx`
```typescript
// Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:
href={`/login?return=${encodeURIComponent(router.asPath)}`}
//                      â†‘ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©

// Ø²Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨:
href={`/login?return=${encodeURIComponent(router.asPath)}`}
```

---

## ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Return URL

### Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ 1: ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø¹Ø§Ø¯ÙŠ (Email/Phone)
```
1. Ø§ÙØªØ­: http://localhost:3000/contact
2. Ø§Ø¶ØºØ· "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„" ÙÙŠ Header
3. URL Ø§Ù„Ø¢Ù†: /login?return=/contact
4. Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯: test@ainoman.om
5. Ø£Ø¯Ø®Ù„ password: 12345678
6. Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„
7. âœ… Ø³ØªØ¹ÙˆØ¯ Ø¥Ù„Ù‰: /contact
```

### Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ 2: ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø¨Ù€ OAuth
```
1. Ø§ÙØªØ­: http://localhost:3000/properties
2. Ø§Ø¶ØºØ· "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„"
3. URL: /login?return=/properties
4. Ø§Ø®ØªØ± "ÙˆØ³Ø§Ø¦Ù„ Ø§Ù„ØªÙˆØ§ØµÙ„"
5. Ø§Ø¶ØºØ· Google
6. OAuth flow ÙŠØ¹Ù…Ù„...
7. âœ… Ø³ØªØ¹ÙˆØ¯ Ø¥Ù„Ù‰: /properties
```

### Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ 3: Ù…Ø¹ Ø§Ù„ØªÙˆØ«ÙŠÙ‚
```
1. Ø§ÙØªØ­: http://localhost:3000/search
2. Ø§Ø¶ØºØ· "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„"
3. URL: /login?return=/search
4. Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ (Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯ ØºÙŠØ± Ù…ÙˆØ«Ù‚)
5. Ø³ØªØ°Ù‡Ø¨ Ø¥Ù„Ù‰: /auth/verify?return=/search
6. ÙˆØ«Ù‘Ù‚ Ø­Ø³Ø§Ø¨Ùƒ (Ø¨Ø±ÙŠØ¯/Ù‡Ø§ØªÙ/ÙˆØ«Ø§Ø¦Ù‚)
7. âœ… Ø³ØªØ¹ÙˆØ¯ Ø¥Ù„Ù‰: /search
```

---

## ğŸ’¡ Ø­Ø§Ù„Ø§Øª Ø®Ø§ØµØ©

### Ø§Ù„Ø­Ø§Ù„Ø© 1: Ø¨Ø¯ÙˆÙ† return ÙÙŠ URL
```
http://localhost:3000/login (Ø¨Ø¯ÙˆÙ† ?return=)
â†“ Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
â†’ /dashboard (Ø§ÙØªØ±Ø§Ø¶ÙŠ)
```

### Ø§Ù„Ø­Ø§Ù„Ø© 2: return ØºÙŠØ± ØµØ­ÙŠØ­
```
/login?return=https://external-site.com
â†“
â†’ /dashboard (Ù„Ø£Ù…Ø§Ù† - ÙŠØ±ÙØ¶ URLs Ø®Ø§Ø±Ø¬ÙŠØ©)
```

### Ø§Ù„Ø­Ø§Ù„Ø© 3: Ù…Ù† ØµÙØ­Ø© Ù„Ø§ ØªØ­ØªØ§Ø¬ login
```
/login Ù…Ù† /policies/terms
â†“
â†’ /policies/terms (ÙŠØ¹ÙˆØ¯ Ù„Ù‡Ø§ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„)
```

---

## ğŸ”’ Ø§Ù„Ø£Ù…Ø§Ù†

### Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† return URL:
```typescript
function getReturn(router) {
  const ret = router.query.return as string || "";
  // âœ… ÙŠÙ‚Ø¨Ù„ ÙÙ‚Ø· URLs Ø¯Ø§Ø®Ù„ÙŠØ© (ØªØ¨Ø¯Ø£ Ø¨Ù€ /)
  return ret && ret.startsWith("/") ? ret : "/dashboard";
}
```

**Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ù…Ù†:**
- âŒ Open redirect attacks
- âŒ URLs Ø®Ø§Ø±Ø¬ÙŠØ©
- âŒ JavaScript ÙÙŠ URL

---

## ğŸ“Š Ù…Ø«Ø§Ù„ ÙˆØ§Ù‚Ø¹ÙŠ

### ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:

```
ğŸ  ÙŠØªØµÙØ­ Ø¹Ù‚Ø§Ø±: /properties/P-20251005151348
   â†“ ÙŠØ±ÙŠØ¯ Ø­Ø¬Ø²Ù‡
   â†“ Ù„ÙƒÙ†Ù‡ ØºÙŠØ± Ù…Ø³Ø¬Ù„
   â†“
ğŸ” ÙŠØ¶ØºØ· "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„"
   â†“ URL: /login?return=/properties/P-20251005151348
   â†“
ğŸ“ ÙŠØ³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø¨Ù€ Google
   â†“ OAuth flow ÙŠØ¹Ù…Ù„
   â†“
âœ… ÙŠØ¹ÙˆØ¯ Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù€ /properties/P-20251005151348
   â†“
ğŸ¯ ÙŠÙƒÙ…Ù„ Ø§Ù„Ø­Ø¬Ø² Ø¨Ø¯ÙˆÙ† ØªØ¹Ø·ÙŠÙ„!
```

**Ø¨Ø¯ÙˆÙ† Return URL:**
âŒ ÙƒØ§Ù† Ø³ÙŠØ°Ù‡Ø¨ Ù„Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ ÙˆÙŠÙ†Ø³Ù‰ Ø§Ù„Ø¹Ù‚Ø§Ø± Ø§Ù„Ø°ÙŠ ÙƒØ§Ù† ÙŠØ±ÙŠØ¯ Ø­Ø¬Ø²Ù‡!

**Ù…Ø¹ Return URL:**
âœ… ÙŠØ¹ÙˆØ¯ Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù†ÙØ³ Ø§Ù„Ø¹Ù‚Ø§Ø± ÙˆÙŠÙƒÙ…Ù„ Ø§Ù„Ø­Ø¬Ø²!

---

## ğŸ‰ Ø§Ù„ÙÙˆØ§Ø¦Ø¯

1. **ØªØ¬Ø±Ø¨Ø© Ù…Ø³ØªØ®Ø¯Ù… Ø£ÙØ¶Ù„** - Ù„Ø§ ÙŠØ¶ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
2. **Ù…Ø¹Ø¯Ù„ ØªØ­ÙˆÙŠÙ„ Ø£Ø¹Ù„Ù‰** - ÙŠÙƒÙ…Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø§ Ø¨Ø¯Ø£Ù‡
3. **Ø£Ù‚Ù„ Ø¥Ø­Ø¨Ø§Ø·** - Ù„Ø§ Ø­Ø§Ø¬Ø© Ù„Ù„Ø¨Ø­Ø« Ù…Ù† Ø¬Ø¯ÙŠØ¯
4. **Ø£ÙƒØ«Ø± Ø§Ø­ØªØ±Ø§ÙÙŠØ©** - ÙƒØ§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„ÙƒØ¨Ø±Ù‰

---

## âœ… Ù…Ù„Ø®Øµ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª

| Ø§Ù„Ù…Ù„Ù | Ø§Ù„ØªØ­Ø¯ÙŠØ« |
|-------|----------|
| `login.tsx` | Ø¥Ø¶Ø§ÙØ© return URL ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø¯ÙˆØ§Ù„ Login |
| `oauth-success.tsx` | Ù‚Ø±Ø§Ø¡Ø© return URL Ù…Ù† localStorage |
| `verify.tsx` | Ø¯Ø¹Ù… return URL Ø¨Ø¹Ø¯ Ø§Ù„ØªÙˆØ«ÙŠÙ‚ |
| `Header.tsx` | Ø¥Ø¶Ø§ÙØ© return URL ÙÙŠ Ø£Ø²Ø±Ø§Ø± Login |

---

## ğŸ§ª Ø¬Ø±Ø¨ Ø§Ù„Ø¢Ù†!

```
1. Ø§ÙØªØ­ Ø£ÙŠ ØµÙØ­Ø© (Ù…Ø«Ù„Ø§Ù‹: /contact)
2. Ø§Ø¶ØºØ· "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„"
3. Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø¨Ø£ÙŠ Ø·Ø±ÙŠÙ‚Ø©
4. Ø³ØªØ¹ÙˆØ¯ Ù„Ù€ /contact ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹! âœ…
```

---

*ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ·Ø¨ÙŠÙ‚: 8 Ø£ÙƒØªÙˆØ¨Ø± 2025*  
*Ø§Ù„Ø­Ø§Ù„Ø©: âœ… Ù…ÙƒØªÙ…Ù„ ÙˆÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ù…Ø«Ø§Ù„ÙŠ*

