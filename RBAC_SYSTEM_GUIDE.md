# ๐ ุฏููู ูุธุงู ุงูุชุญูู ูู ุงููุตูู ุญุณุจ ุงูุฏูุฑ (RBAC)

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ูุชูุงูู ููุชุญูู ูู ุนุฑุถ ุงูุจูุงูุงุช ุญุณุจ ุฏูุฑ ุงููุณุชุฎุฏู ูู ููุตุฉ ุนูู ุนููุงู.

---

## ๐ฅ ุงูุฃุฏูุงุฑ ุงููุชุงุญุฉ

### 1. **Admin** - ุงููุฏูุฑ ุงูุนุงู
```typescript
role: 'admin'
```
**ุงูุตูุงุญูุงุช:**
- โ ุฑุคูุฉ **ุฌููุน** ุงูุนูุงุฑุงุช ูุงููุญุฏุงุช
- โ ุฑุคูุฉ **ุฌููุน** ุงูุญุฌูุฒุงุช ูุงูููุงู
- โ ุฑุคูุฉ **ุฌููุน** ุงูููุงุชูุฑ ูุงููุถุงูุง
- โ ุชุนุฏูู ูุญุฐู ุฃู ุดูุก
- โ ุงููุตูู ูุฌููุน ุตูุญุงุช `/admin/*`

**ุงูุตูุญุงุช ุงูุฎุงุตุฉ:**
- `/admin/properties` - ูู ุงูุนูุงุฑุงุช
- `/admin/units` - ูู ุงููุญุฏุงุช
- `/admin/subscriptions` - ุฅุฏุงุฑุฉ ุงูุจุงูุงุช
- `/admin/users` - ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู

---

### 2. **Property Owner** - ูุงูู ุงูุนูุงุฑ
```typescript
role: 'property_owner'
```
**ุงูุตูุงุญูุงุช:**
- โ ุฑุคูุฉ **ุนูุงุฑุงุชู ููุท**
- โ ุฅุถุงูุฉ/ุชุนุฏูู/ุญุฐู ุนูุงุฑุงุชู
- โ ุฑุคูุฉ ุญุฌูุฒุงุช ุนูุงุฑุงุชู
- โ ุฑุคูุฉ ููุงุชูุฑ ุนูุงุฑุงุชู
- โ ุฑุคูุฉ ููุงู ุนูุงุฑุงุชู
- โ ุชุนููู ูุฏูุฑูู ููุนูุงุฑุงุช

**ุงูุตูุญุงุช ุงูุฎุงุตุฉ:**
- `/properties/unified-management` - ุฅุฏุงุฑุฉ ููุญุฏุฉ
- `/property/[id]/admin` - ุฅุฏุงุฑุฉ ุนูุงุฑ ูุญุฏุฏ
- `/dashboard/owner` - ููุญุฉ ุชุญูู ุงููุงูู

**ุงูููุชุฑุฉ:**
```typescript
properties.filter(p => 
  p.ownerId === user.id || 
  p.createdBy === user.id
)
```

---

### 3. **Property Manager** - ูุฏูุฑ ุงูุนูุงุฑ
```typescript
role: 'property_manager'
```
**ุงูุตูุงุญูุงุช:**
- โ ุฑุคูุฉ ุงูุนูุงุฑุงุช **ุงููุณูุฏุฉ ูู ููุท**
- โ ุฅุฏุงุฑุฉ ุงููุญุฏุงุช (ุญุณุจ ุตูุงุญูุงุช ุงููุงูู)
- โ ุฅุฏุงุฑุฉ ุงูููุงู ูุงูุตูุงูุฉ
- โ ุฑุคูุฉ ุงูุญุฌูุฒุงุช ูุงูููุงุชูุฑ
- โ **ูุง ูุณุชุทูุน** ุญุฐู ุงูุนูุงุฑ (ุฅูุง ุจุตูุงุญูุฉ ูู ุงููุงูู)

**ุงูุตูุญุงุช ุงูุฎุงุตุฉ:**
- `/properties/unified-management` - ุงูุนูุงุฑุงุช ุงููุณูุฏุฉ
- `/property/[id]/admin` - ุฅุฏุงุฑุฉ ูุญุฏูุฏุฉ

**ุงูููุชุฑุฉ:**
```typescript
properties.filter(p => 
  p.managerId === user.id ||
  p.managers?.includes(user.id)
)
```

---

### 4. **Tenant** - ุงููุณุชุฃุฌุฑ
```typescript
role: 'tenant'
```
**ุงูุตูุงุญูุงุช:**
- โ ุฑุคูุฉ **ุงููุญุฏุฉ ุงููุณุชุฃุฌุฑุฉ ููุท**
- โ ุนุฑุถ ุชูุงุตูู ุนูุงุฑู
- โ ุฑุคูุฉ ููุงุชูุฑู
- โ ุฅุถุงูุฉ ุทูุจุงุช ุตูุงูุฉ
- โ ุฑุคูุฉ ููุงูู
- โ **ูุง ูุณุชุทูุน** ุงูุชุนุฏูู ุนูู ุงูุนูุงุฑ
- โ **ูุง ูุณุชุทูุน** ุฑุคูุฉ ูุนูููุงุช ูุงููุฉ ุงููุงูู

**ุงูุตูุญุงุช ุงูุฎุงุตุฉ:**
- `/dashboard/tenant` - ููุญุฉ ุชุญูู ุงููุณุชุฃุฌุฑ
- `/profile` - ูุนูููุงุชู ุงูุดุฎุตูุฉ

**ุงูููุชุฑุฉ:**
```typescript
properties.filter(p => 
  p.tenantId === user.id ||
  p.units?.some(u => u.tenantId === user.id)
)
```

---

### 5. **User** - ูุณุชุฎุฏู ุนุงุฏู
```typescript
role: 'user'
```
**ุงูุตูุงุญูุงุช:**
- โ ุฑุคูุฉ ุงูุนูุงุฑุงุช **ุงูููุดูุฑุฉ ููุท**
- โ ุงูุจุญุซ ูุงูุชุตูุญ
- โ ุญุฌุฒ ุงููุญุฏุงุช
- โ ุฅุถุงูุฉ ููููุถูุฉ
- โ **ูุง ูุณุชุทูุน** ุฑุคูุฉ ุนูุงุฑุงุช ุฎุงุตุฉ
- โ **ูุง ูุณุชุทูุน** ุฑุคูุฉ ูุนูููุงุช ูุงููุฉ

**ุงูุตูุญุงุช ุงูุฎุงุตุฉ:**
- `/properties` - ุชุตูุญ ุงูุนูุงุฑุงุช
- `/bookings` - ุญุฌูุฒุงุชู
- `/profile` - ูููู ุงูุดุฎุตู

**ุงูููุชุฑุฉ:**
```typescript
properties.filter(p => 
  p.published === true && 
  p.status !== 'hidden'
)
```

---

## ๐ ูุตูููุฉ ุงูุตูุงุญูุงุช

| ุงูุฅุฌุฑุงุก | Admin | Owner | Manager | Tenant | User |
|---------|-------|-------|---------|--------|------|
| **ุฑุคูุฉ ุฌููุน ุงูุนูุงุฑุงุช** | โ | โ | โ | โ | โ |
| **ุฑุคูุฉ ุนูุงุฑุงุชู** | โ | โ | โ | โ | โ |
| **ุฅุถุงูุฉ ุนูุงุฑ** | โ | โ | โ | โ | โ |
| **ุชุนุฏูู ุนูุงุฑ** | โ | โ | โ* | โ | โ |
| **ุญุฐู ุนูุงุฑ** | โ | โ | โ | โ | โ |
| **ุฑุคูุฉ ุฌููุน ุงููุญุฏุงุช** | โ | โ | โ | โ | โ |
| **ุฑุคูุฉ ูุญุฏุงุชู** | โ | โ | โ | โ | โ |
| **ุฑุคูุฉ ุฌููุน ุงูููุงุชูุฑ** | โ | โ | โ | โ | โ |
| **ุฑุคูุฉ ููุงุชูุฑู** | โ | โ | โ | โ | โ |
| **ุฑุคูุฉ ุฌููุน ุงูููุงู** | โ | โ | โ | โ | โ |
| **ุฑุคูุฉ ููุงูู** | โ | โ | โ | โ | โ |
| **ุญุฌุฒ ูุญุฏุฉ** | โ | โ | โ | โ | โ |

`*` ุจุตูุงุญูุงุช ูู ุงููุงูู

---

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู

### ูู ุงูุตูุญุงุช (Frontend):

```typescript
import { getCurrentUser, filterPropertiesByRole } from '@/lib/rbac';

function MyPropertiesPage() {
  const [properties, setProperties] = useState([]);

  useEffect(() => {
    const user = getCurrentUser();
    
    fetch('/api/properties')
      .then(r => r.json())
      .then(data => {
        // ููุชุฑุฉ ุญุณุจ ุงูุฏูุฑ
        const filtered = filterPropertiesByRole(data.items, user);
        setProperties(filtered);
      });
  }, []);

  // ุนุฑุถ ุงูุนูุงุฑุงุช ุงููููุชุฑุฉ ููุท
  return <div>{properties.map(...)}</div>
}
```

### ูู ุงูู APIs (Backend):

```typescript
import { filterPropertiesByRole } from '@/lib/rbac';

export default function handler(req: NextApiRequest, res: NextApiResponse) {
  // ุงูุญุตูู ุนูู ุงููุณุชุฎุฏู ูู headers ุฃู session
  const user = {
    id: req.headers['x-user-id'],
    role: req.headers['x-user-role'] || 'user'
  };

  const allProperties = getAll();
  
  // ููุชุฑุฉ ุญุณุจ ุงูุฏูุฑ
  const filtered = filterPropertiesByRole(allProperties, user);
  
  res.json({ items: filtered });
}
```

---

## ๐ ุงูุตูุญุงุช ูุงูุฃุฏูุงุฑ ุงููุณููุญุฉ

### ุตูุญุงุช ุนุงูุฉ (ุงููู):
- `/` - ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
- `/properties` - ุชุตูุญ ุงูุนูุงุฑุงุช (ููุดูุฑุฉ ููุท ููุฒูุงุฑ)
- `/about` - ูู ูุญู
- `/contact` - ุงุชุตู ุจูุง

### ุตูุญุงุช ุงููุณุชุฎุฏู (User):
- `/profile` - ูููู ุงูุดุฎุตู
- `/bookings` - ุญุฌูุฒุงุชู
- `/favorites` - ุงูููุถูุฉ

### ุตูุญุงุช ุงููุณุชุฃุฌุฑ (Tenant):
- `/dashboard/tenant` - ููุญุฉ ุงููุณุชุฃุฌุฑ
- `/profile` - ูุนูููุงุชู
- `/invoices` - ููุงุชูุฑู (ููุท ููุงุชูุฑู)
- `/tasks` - ููุงูู (ุทูุจุงุช ุงูุตูุงูุฉ)

### ุตูุญุงุช ุงููุงูู (Owner):
- `/dashboard/owner` - ููุญุฉ ุงููุงูู
- `/properties/unified-management` - ุฅุฏุงุฑุฉ ุนูุงุฑุงุชู
- `/property/[id]/admin` - ุฅุฏุงุฑุฉ ุนูุงุฑ ูุญุฏุฏ
- `/invoices` - ููุงุชูุฑ ุนูุงุฑุงุชู
- `/tasks` - ููุงู ุนูุงุฑุงุชู

### ุตูุญุงุช ุงููุฏูุฑ (Manager):
- `/dashboard/property-owner` - ููุญุฉ ุงููุฏูุฑ
- `/properties/unified-management` - ุงูุนูุงุฑุงุช ุงููุณูุฏุฉ
- `/property/[id]/admin` - ุฅุฏุงุฑุฉ ูุญุฏูุฏุฉ

### ุตูุญุงุช ุงูุฅุฏุงุฑุฉ (Admin):
- `/admin/*` - ุฌููุน ุตูุญุงุช ุงูุฅุฏุงุฑุฉ
- `/admin/properties` - ูู ุงูุนูุงุฑุงุช
- `/admin/units` - ูู ุงููุญุฏุงุช
- `/admin/users` - ุงููุณุชุฎุฏููู
- `/admin/subscriptions` - ุงูุจุงูุงุช

---

## ๐ฏ ุงูุชูุตูุฉ ุงูููุงุฆูุฉ

### ุงูุญุงูุฉ ุงูุญุงููุฉ:

**ุงููุดููุฉ:**
```
โ /api/properties ูุนุฑุถ ุฌููุน ุงูุนูุงุฑุงุช ููุฌููุน
โ ูุง ุชูุฌุฏ ููุชุฑุฉ ุญุณุจ ุงูุฏูุฑ
โ ุงููุณุชุฃุฌุฑ ููููู ุฑุคูุฉ ุนูุงุฑุงุช ุงูุขุฎุฑูู
```

**ุงูุญู:**
```
โ ุชุทุจูู ูุธุงู RBAC
โ ููุชุฑุฉ ุงูุจูุงูุงุช ูู ูู ุตูุญุฉ
โ ูุญุต ุงูุตูุงุญูุงุช ูุจู ุงูุนุฑุถ
```

---

### ุงูุฎุทูุงุช ุงููุทููุจุฉ:

#### **1. ุชุทุจูู RBAC ุนูู ุตูุญุฉ `/properties`**
- ููุชุฑุฉ ุงูุนูุงุฑุงุช ุงูููุดูุฑุฉ ููุฒูุงุฑ
- ุนุฑุถ ุนูุงุฑุงุช ุงููุณุชุฎุฏู ููุท ููููุงู

#### **2. ุชุทุจูู RBAC ุนูู `/properties/unified-management`**
- ุนุฑุถ ุนูุงุฑุงุช ุงููุณุชุฎุฏู ููุท
- ููุชุฑุฉ ุงููุญุฏุงุช ุญุณุจ ุงูุนูุงุฑุงุช

#### **3. ุชุทุจูู RBAC ุนูู `/admin/units`**
- ูููุฏูุฑูู ููุท
- ุนุฑุถ ุฌููุน ุงููุญุฏุงุช

#### **4. ุชุทุจูู RBAC ุนูู `/profile`**
- ููุชุฑุฉ ุงูุญุฌูุฒุงุช ุญุณุจ ุงููุณุชุฎุฏู
- ููุชุฑุฉ ุงูููุงู ุญุณุจ ุงููุณุชุฎุฏู
- ููุชุฑุฉ ุงูููุงุชูุฑ ุญุณุจ ุงููุณุชุฎุฏู

---

## ๐ ูู ุชุฑูุฏูู ุฃู:

**ุฃ) ุฃุทุจู ูุธุงู RBAC ุนูู ุฌููุน ุงูุตูุญุงุชุ**
```
ุณุฃููู ุจู:
1. ุชุทุจูู filterPropertiesByRole ูู ูู ุตูุญุฉ
2. ุชุทุจูู filterUnitsByRole ูู ุตูุญุงุช ุงููุญุฏุงุช
3. ุชุทุจูู filterTasksByRole ูู ุตูุญุงุช ุงูููุงู
4. ุชุทุจูู filterInvoicesByRole ูู ุตูุญุงุช ุงูููุงุชูุฑ
5. ุฅุถุงูุฉ ูุญุต ุงูุฏูุฑ ูู ุฌููุน ุงูุตูุญุงุช
6. ุงุฎุชุจุงุฑ ุดุงูู
```

**ุจ) ุฃุจุฏุฃ ุจุตูุญุฉ ูุงุญุฏุฉ ููุซุงูุ**
```
ุณุฃุทุจู ุนูู /properties/unified-management ููุซุงู
ุซู ููุชูู ููุจููุฉ
```

**ุฌ) ุฃูุดุฆ ูุธุงู ุญุณุงุจุงุช ุงููุณุชุฎุฏููู ุฃููุงูุ**
```
ุณุฃูุดุฆ:
1. ุตูุญุฉ ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู
2. ุชุนููู ุงูุฃุฏูุงุฑ
3. ุฑุจุท ุงูุญุณุงุจุงุช ุจุงูุนูุงุฑุงุช
4. ุซู ูุทุจู RBAC
```

**ูุง ูู ุงุฎุชูุงุฑูุ** ๐ฏ
