// src/lib/i18n.ts
import React, { createContext, useContext, useEffect, useMemo, useState } from "react";

export type Lang = "ar" | "en" | "fr" | "hi" | "fa" | "ur";
const SUPPORTED: Lang[] = ["ar", "en", "fr", "hi", "fa", "ur"];
const RTL_LANGS: Lang[] = ["ar", "fa", "ur"];

// ————— القواميس (مضمنة بالكامل) —————
type Dict = Record<string, string>;
type Bundle = Record<Lang, Dict>;

const ar: Dict = {
  "app.name": "عين عُمان",
  "nav.home": "الرئيسية",
  "nav.search": "بحث",
  "nav.properties": "العقارات",
  "nav.auctions": "المزادات",
  "nav.partners": "الشركاء",
  "nav.invest": "الاستثمار",
  "nav.about": "من نحن",
  "nav.contact": "تواصل معنا",
  "nav.login": "تسجيل الدخول",
  "nav.logout": "تسجيل الخروج",
  "nav.dashboard": "لوحة التحكم",
  "common.visit": "زيارة",
  "common.view": "عرض",
  "common.view.details": "عرض التفاصيل",
  "common.edit": "تعديل",
  "common.delete": "حذف",
  "common.back": "رجوع",
  "common.next": "التالي",
  "common.previous": "السابق",
  "common.search": "بحث",
  "common.filter": "تصفية",
  "common.reset": "إعادة تعيين",
  "common.save": "حفظ",
  "common.publish": "نشر",
  "common.unpublish": "إلغاء النشر",
  "common.submit": "إرسال",
  "common.cancel": "إلغاء",
  "common.ok": "حسناً",
  "common.yes": "نعم",
  "common.no": "لا",
  "common.apply": "تطبيق",
  "common.clear": "مسح",
  "common.location": "الموقع",
  "common.remaining": "الوقت المتبقي",
  "common.initial_price": "السعر الابتدائي",
  "common.current_bid": "المزايدة الحالية",
  "common.bid": "قدّم مزايدة",
  "common.loading": "جاري التحميل…",
  "common.loading.properties": "جاري تحميل العقارات...",
  "common.error": "حدث خطأ غير متوقع",
  "common.success": "تمت العملية بنجاح",
  "common.print": "طباعة",
  "common.preview": "معاينة",
  "common.language": "اللغة",
  "common.theme": "الوضع",
  "common.theme.light": "فاتح",
  "common.theme.dark": "داكن",
  "common.price": "السعر",
  "common.area": "المساحة",
  "common.bedrooms": "غرف نوم",
  "common.bathrooms": "حمامات",
  "common.active": "نشط",
  "badges.title": "الشارات",
  "auctions.title": "المزايدات العقارية",
  "auctions.subtitle": "اكتشف أفضل الفرص العقارية بالمزايدة.",
  "auctions.search": "ابحث عن عقار أو موقع...",
  "auctions.filter.all": "جميع العقارات",
  "auctions.filter.villas": "فيلات",
  "auctions.filter.apartments": "شقق",
  "auctions.filter.lands": "أراضي",
  "auctions.section.active": "المزايدات النشطة",
  "auctions.section.featured": "عقارات مميزة",
  "auctions.section.map": "مواقع المزايدات النشطة",
  "auctions.cta.reset": "إعادة تعيين البحث",
  "auctions.details.back": "العودة إلى المزادات",
  "auctions.bid.submit": "تقديم المزايدة",
  "auctions.bid.current": "المزايدة الحالية",
  "auctions.bid.start": "السعر الابتدائي",
  "auctions.location": "الموقع",
  "auctions.features": "الميزات",
  "auctions.history": "تاريخ المزايدات",
  "auctions.loading": "جاري تحميل بيانات العقار...",
  "auctions.notfound": "العقار غير موجود",
  "common.partner.note": "سيتم ربط هذه الصفحة بمنصة مزادات عُمان قريبًا.",
  "partners.title": "شركاؤنا",
  "partners.subtitle": "شركاؤنا الموثوقون في قطاع العقار.",
  "partners.search.placeholder": "ابحث باسم الشريك…",
  "partners.category.all": "جميع الفئات",
  "partners.category.agency": "وكالات",
  "partners.category.developer": "مطوّرون",
  "partners.category.bank": "تمويل",
  "partners.category.service": "خدمات",
  "partners.cta.join": "أرسل طلب الانضمام",
  "partners.empty": "لا توجد نتائج.",
  "invest.title": "الاستثمار العقاري",
  "invest.subtitle": "فرص استثمارية مدروسة مع عوائد متوقعة وإدارة شفافة.",
  "invest.filter.all": "الكل",
  "invest.filter.reit": "صناديق عقارية (REITs)",
  "invest.filter.crowd": "استثمار تشاركي",
  "invest.filter.debt": "تمويل/دين عقاري",
  "invest.card.min": "الحد الأدنى",
  "invest.card.roi": "العائد المتوقع",
  "invest.card.duration": "المدة",
  "invest.card.location": "الموقع",
  "invest.card.learn": "تفاصيل الفرصة",
  "invest.note": "سيتم لاحقًا ربط الصفحة بواجهات تمويل واستثمار وربط مع البنوك.",
  "faq.title": "الأسئلة الشائعة",
  "faq.subtitle": "إجابات سريعة حول Ain Oman.",
  "faq.contact": "لم تجد إجابتك؟ تواصل معنا",
  "footer.rights": "© {year} عين عُمان. جميع الحقوق محفوظة.",
  "footer.links.privacy": "سياسة الخصوصية",
  "footer.links.terms": "الشروط والأحكام",
  "footer.links.faq": "الأسئلة الشائعة",
  "subs.view.paywall": "الاشتراك مطلوب لعرض تفاصيل المزاد",
  "subs.required": "هذه الميزة متاحة للمشتركين فقط.",
  "subs.upgrade": "ترقية الخطة",
  "ai.analysis": "التحليل الذكي",
};

const en: Dict = {
  "app.name": "Ain Oman",
  "nav.home": "Home",
  "nav.search": "Search",
  "nav.properties": "Properties",
  "nav.auctions": "Auctions",
  "nav.partners": "Partners",
  "nav.invest": "Invest",
  "nav.about": "About",
  "nav.contact": "Contact",
  "nav.login": "Login",
  "nav.logout": "Logout",
  "nav.dashboard": "Dashboard",
  "common.visit": "Visit",
  "common.view": "View",
  "common.view.details": "View details",
  "common.edit": "Edit",
  "common.delete": "Delete",
  "common.back": "Back",
  "common.next": "Next",
  "common.previous": "Previous",
  "common.search": "Search",
  "common.filter": "Filter",
  "common.reset": "Reset",
  "common.save": "Save",
  "common.publish": "Publish",
  "common.unpublish": "Unpublish",
  "common.submit": "Submit",
  "common.cancel": "Cancel",
  "common.ok": "OK",
  "common.yes": "Yes",
  "common.no": "No",
  "common.apply": "Apply",
  "common.clear": "Clear",
  "common.location": "Location",
  "common.remaining": "Time remaining",
  "common.initial_price": "Starting price",
  "common.current_bid": "Current bid",
  "common.bid": "Place bid",
  "common.loading": "Loading…",
  "common.loading.properties": "Loading properties...",
  "common.error": "Unexpected error",
  "common.success": "Operation completed successfully",
  "common.print": "Print",
  "common.preview": "Preview",
  "common.language": "Language",
  "common.theme": "Theme",
  "common.theme.light": "Light",
  "common.theme.dark": "Dark",
  "common.price": "Price",
  "common.area": "Area",
  "common.bedrooms": "Bedrooms",
  "common.bathrooms": "Bathrooms",
  "badges.title": "Badges",
  "auctions.title": "Real Estate Auctions",
  "auctions.subtitle": "Discover the best auction opportunities.",
  "auctions.search": "Search for a property or location...",
  "auctions.filter.all": "All",
  "auctions.filter.villas": "Villas",
  "auctions.filter.apartments": "Apartments",
  "auctions.filter.lands": "Lands",
  "auctions.section.active": "Active auctions",
  "auctions.section.featured": "Featured properties",
  "auctions.section.map": "Active auction locations",
  "auctions.cta.reset": "Reset search",
  "auctions.details.back": "Back to auctions",
  "auctions.bid.submit": "Submit bid",
  "auctions.bid.current": "Current bid",
  "auctions.bid.start": "Starting price",
  "auctions.location": "Location",
  "auctions.features": "Features",
  "auctions.history": "Bid history",
  "auctions.loading": "Loading property data...",
  "auctions.notfound": "Property not found",
  "common.partner.note": "This page will be linked to Oman Auctions soon.",
  "partners.title": "Our Partners",
  "partners.subtitle": "Trusted partners in the real estate sector.",
  "partners.search.placeholder": "Search partner name…",
  "partners.category.all": "All categories",
  "partners.category.agency": "Agencies",
  "partners.category.developer": "Developers",
  "partners.category.bank": "Finance",
  "partners.category.service": "Services",
  "partners.cta.join": "Send join request",
  "partners.empty": "No results.",
  "invest.title": "Real Estate Investment",
  "invest.subtitle": "Opportunities with expected returns and transparent management.",
  "invest.filter.all": "All",
  "invest.filter.reit": "REITs",
  "invest.filter.crowd": "Crowd investment",
  "invest.filter.debt": "Real estate debt",
  "invest.card.min": "Minimum",
  "invest.card.roi": "Expected ROI",
  "invest.card.duration": "Duration",
  "invest.card.location": "Location",
  "invest.card.learn": "Opportunity details",
  "invest.note": "Will later connect to finance/invest APIs and banks.",
  "faq.title": "FAQ",
  "faq.subtitle": "Quick answers about Ain Oman.",
  "faq.contact": "Didn’t find your answer? Contact us",
  "footer.rights": "© {year} Ain Oman. All rights reserved.",
  "footer.links.privacy": "Privacy Policy",
  "footer.links.terms": "Terms & Conditions",
  "footer.links.faq": "FAQ",
  "common.active": "Active",
  "subs.view.paywall": "Subscription required to view auction details",
  "subs.required": "This feature is available to subscribers only.",
  "subs.upgrade": "Upgrade plan",
  "ai.analysis": "AI analysis",
};

const fr: Dict = {
  "app.name": "Ain Oman",
  "nav.home": "Accueil",
  "nav.search": "Recherche",
  "nav.properties": "Biens",
  "nav.auctions": "Enchères",
  "nav.partners": "Partenaires",
  "nav.invest": "Investir",
  "nav.about": "À propos",
  "nav.contact": "Contact",
  "nav.login": "Connexion",
  "nav.logout": "Déconnexion",
  "nav.dashboard": "Tableau de bord",
  "common.visit": "Visiter",
  "common.view": "Voir",
  "common.view.details": "Voir les détails",
  "common.edit": "Modifier",
  "common.delete": "Supprimer",
  "common.back": "Retour",
  "common.next": "Suivant",
  "common.previous": "Précédent",
  "common.search": "Recherche",
  "common.filter": "Filtrer",
  "common.reset": "Réinitialiser",
  "common.save": "Enregistrer",
  "common.publish": "Publier",
  "common.unpublish": "Dépublier",
  "common.submit": "Envoyer",
  "common.cancel": "Annuler",
  "common.ok": "OK",
  "common.yes": "Oui",
  "common.no": "Non",
  "common.apply": "Appliquer",
  "common.clear": "Effacer",
  "common.location": "Localisation",
  "common.remaining": "Temps restant",
  "common.initial_price": "Prix de départ",
  "common.current_bid": "Offre actuelle",
  "common.bid": "Enchérir",
  "common.loading": "Chargement…",
  "common.loading.properties": "Chargement des biens...",
  "common.error": "Erreur inattendue",
  "common.success": "Opération réussie",
  "common.print": "Imprimer",
  "common.preview": "Aperçu",
  "common.language": "Langue",
  "common.theme": "Thème",
  "common.theme.light": "Clair",
  "common.theme.dark": "Sombre",
  "common.price": "Prix",
  "common.area": "Surface",
  "common.bedrooms": "Chambres",
  "common.bathrooms": "Salles de bain",
  "badges.title": "Badges",
  "auctions.title": "Enchères immobilières",
  "auctions.subtitle": "Découvrez les meilleures opportunités.",
  "auctions.search": "Rechercher un bien ou un lieu...",
  "auctions.filter.all": "Tous",
  "auctions.filter.villas": "Villas",
  "auctions.filter.apartments": "Appartements",
  "auctions.filter.lands": "Terrains",
  "auctions.section.active": "Enchères en cours",
  "auctions.section.featured": "Biens en vedette",
  "auctions.section.map": "Lieux des enchères en cours",
  "auctions.cta.reset": "Réinitialiser la recherche",
  "auctions.details.back": "Retour aux enchères",
  "auctions.bid.submit": "Soumettre l'offre",
  "auctions.bid.current": "Offre actuelle",
  "auctions.bid.start": "Prix de départ",
  "auctions.location": "Localisation",
  "auctions.features": "Caractéristiques",
  "auctions.history": "Historique des offres",
  "auctions.loading": "Chargement des données du bien...",
  "auctions.notfound": "Bien introuvable",
  "common.partner.note": "Cette page sera bientôt reliée à Oman Auctions.",
  "partners.title": "Nos partenaires",
  "partners.subtitle": "Partenaires de confiance du secteur.",
  "partners.search.placeholder": "Rechercher un partenaire…",
  "partners.category.all": "Toutes les catégories",
  "partners.category.agency": "Agences",
  "partners.category.developer": "Promoteurs",
  "partners.category.bank": "Finance",
  "partners.category.service": "Services",
  "partners.cta.join": "Demande d’adhésion",
  "partners.empty": "Aucun résultat.",
  "invest.title": "Investissement immobilier",
  "invest.subtitle": "Opportunités avec rendement attendu et gestion transparente.",
  "invest.filter.all": "Tous",
  "invest.filter.reit": "REITs",
  "invest.filter.crowd": "Investissement participatif",
  "invest.filter.debt": "Dette immobilière",
  "invest.card.min": "Minimum",
  "invest.card.roi": "ROI attendu",
  "invest.card.duration": "Durée",
  "invest.card.location": "Localisation",
  "invest.card.learn": "Détails de l'opportunité",
  "invest.note": "Connexion future aux APIs finance/invest et banques.",
  "faq.title": "FAQ",
  "faq.subtitle": "Réponses rapides sur Ain Oman.",
  "faq.contact": "Pas trouvé ? Contactez-nous",
  "footer.rights": "© {year} Ain Oman. Tous droits réservés.",
  "footer.links.privacy": "Politique de confidentialité",
  "footer.links.terms": "Conditions générales",
  "footer.links.faq": "FAQ",
  "common.active": "Actif",
  "subs.view.paywall": "Abonnement requis pour voir les détails",
  "subs.required": "Fonction réservée aux abonnés.",
  "subs.upgrade": "Mettre à niveau",
  "ai.analysis": "Analyse IA",
};

const hi: Dict = {
  "app.name": "Ain Oman",
  "nav.home": "मुख्य पृष्ठ",
  "nav.search": "खोज",
  "nav.properties": "संपत्तियाँ",
  "nav.auctions": "नीलामी",
  "nav.partners": "साझेदार",
  "nav.invest": "निवेश",
  "nav.about": "हमारे बारे में",
  "nav.contact": "संपर्क करें",
  "nav.login": "लॉगिन",
  "nav.logout": "लॉगआउट",
  "nav.dashboard": "डैशबोर्ड",
  "common.visit": "देखें",
  "common.view": "देखें",
  "common.view.details": "विवरण देखें",
  "common.edit": "संपादित करें",
  "common.delete": "हटाएँ",
  "common.back": "वापस",
  "common.next": "आगे",
  "common.previous": "पिछला",
  "common.search": "खोज",
  "common.filter": "फ़िल्टर",
  "common.reset": "रीसेट",
  "common.save": "सहेजें",
  "common.publish": "प्रकाशित करें",
  "common.unpublish": "प्रकाशन हटाएँ",
  "common.submit": "जमा करें",
  "common.cancel": "रद्द करें",
  "common.ok": "ठीक है",
  "common.yes": "हाँ",
  "common.no": "नहीं",
  "common.apply": "लागू करें",
  "common.clear": "साफ़ करें",
  "common.location": "स्थान",
  "common.remaining": "शेष समय",
  "common.initial_price": "प्रारंभिक मूल्य",
  "common.current_bid": "वर्तमान बोली",
  "common.bid": "बोली लगाएँ",
  "common.loading": "लोड हो रहा है…",
  "common.loading.properties": "संपत्तियाँ लोड हो रही हैं...",
  "common.error": "अप्रत्याशित त्रुटि",
  "common.success": "क्रिया सफल रही",
  "common.print": "प्रिंट",
  "common.preview": "पूर्वावलोकन",
  "common.language": "भाषा",
  "common.theme": "थीम",
  "common.theme.light": "हल्का",
  "common.theme.dark": "गहरा",
  "common.price": "मूल्य",
  "common.area": "क्षेत्रफल",
  "common.bedrooms": "शयनकक्ष",
  "common.bathrooms": "स्नानघर",
  "badges.title": "बैज",
  "auctions.title": "रियल एस्टेट नीलामी",
  "auctions.subtitle": "सर्वश्रेष्ठ अवसर खोजें।",
  "auctions.search": "संपत्ति या स्थान खोजें...",
  "auctions.filter.all": "सभी",
  "auctions.filter.villas": "विला",
  "auctions.filter.apartments": "अपार्टमेंट",
  "auctions.filter.lands": "प्लॉट",
  "auctions.section.active": "सक्रिय नीलामी",
  "auctions.section.featured": "विशेष संपत्तियाँ",
  "auctions.section.map": "सक्रिय नीलामी स्थान",
  "auctions.cta.reset": "खोज रीसेट करें",
  "auctions.details.back": "नीलामी पर वापस जाएँ",
  "auctions.bid.submit": "बोली जमा करें",
  "auctions.bid.current": "वर्तमान बोली",
  "auctions.bid.start": "प्रारंभिक मूल्य",
  "auctions.location": "स्थान",
  "auctions.features": "विशेषताएँ",
  "auctions.history": "बोली इतिहास",
  "auctions.loading": "संपत्ति डेटा लोड हो रहा है...",
  "auctions.notfound": "संपत्ति नहीं मिली",
  "common.partner.note": "यह पृष्ठ जल्द ही ओमान ऑक्शंस से जोड़ा जाएगा।",
  "partners.title": "हमारे साझेदार",
  "partners.subtitle": "रियल एस्टेट क्षेत्र में भरोसेमंद साझेदार।",
  "partners.search.placeholder": "साझेदार का नाम खोजें…",
  "partners.category.all": "सभी श्रेणियाँ",
  "partners.category.agency": "एजेंसियाँ",
  "partners.category.developer": "डेवलपर्स",
  "partners.category.bank": "वित्त",
  "partners.category.service": "सेवाएँ",
  "partners.cta.join": "जुड़ने का अनुरोध भेजें",
  "partners.empty": "कोई परिणाम नहीं।",
  "invest.title": "रियल एस्टेट निवेश",
  "invest.subtitle": "अपेक्षित रिटर्न और पारदर्शी प्रबंधन।",
  "invest.filter.all": "सभी",
  "invest.filter.reit": "REITs",
  "invest.filter.crowd": "क्राउड निवेश",
  "invest.filter.debt": "रियल एस्टेट ऋण",
  "invest.card.min": "न्यूनतम",
  "invest.card.roi": "अपेक्षित ROI",
  "invest.card.duration": "अवधि",
  "invest.card.location": "स्थान",
  "invest.card.learn": "अवसर विवरण",
  "invest.note": "बाद में वित्त/निवेश API और बैंकिंग एकीकरण से जुड़ेगा।",
  "faq.title": "सामान्य प्रश्न",
  "faq.subtitle": "Ain Oman के बारे में सामान्य प्रश्नों के उत्तर।",
  "faq.contact": "उत्तर नहीं मिला? हमसे संपर्क करें",
  "footer.rights": "© {year} Ain Oman. सर्वाधिकार सुरक्षित.",
  "footer.links.privacy": "गोपनीयता नीति",
  "footer.links.terms": "नियम एवं शर्तें",
  "footer.links.faq": "सामान्य प्रश्न",
  "common.active": "सक्रिय",
  "subs.view.paywall": "विवरण देखने हेतु सदस्यता आवश्यक है",
  "subs.required": "यह सुविधा केवल सदस्यों के लिए।",
  "subs.upgrade": "योजना अपग्रेड करें",
  "ai.analysis": "एआई विश्लेषण",
};

const fa: Dict = {
  "app.name": "عین عمان",
  "nav.home": "خانه",
  "nav.search": "جستجو",
  "nav.properties": "املاک",
  "nav.auctions": "مزایده‌ها",
  "nav.partners": "شرکا",
  "nav.invest": "سرمایه‌گذاری",
  "nav.about": "درباره ما",
  "nav.contact": "تماس با ما",
  "nav.login": "ورود",
  "nav.logout": "خروج",
  "nav.dashboard": "داشبورد",
  "common.visit": "مشاهده",
  "common.view": "مشاهده",
  "common.view.details": "مشاهده جزئیات",
  "common.edit": "ویرایش",
  "common.delete": "حذف",
  "common.back": "بازگشت",
  "common.next": "بعدی",
  "common.previous": "قبلی",
  "common.search": "جستجو",
  "common.filter": "فیلتر",
  "common.reset": "بازنشانی",
  "common.save": "ذخیره",
  "common.publish": "انتشار",
  "common.unpublish": "لغو انتشار",
  "common.submit": "ارسال",
  "common.cancel": "انصراف",
  "common.ok": "باشه",
  "common.yes": "بله",
  "common.no": "خیر",
  "common.apply": "اعمال",
  "common.clear": "پاک کردن",
  "common.location": "مکان",
  "common.remaining": "زمان باقیمانده",
  "common.initial_price": "قیمت شروع",
  "common.current_bid": "پیشنهاد فعلی",
  "common.bid": "ثبت پیشنهاد",
  "common.loading": "در حال بارگذاری…",
  "common.loading.properties": "در حال بارگذاری املاک...",
  "common.error": "خطای غیرمنتظره",
  "common.success": "عملیات موفق",
  "common.print": "چاپ",
  "common.preview": "پیش‌نمایش",
  "common.language": "زبان",
  "common.theme": "حالت",
  "common.theme.light": "روشن",
  "common.theme.dark": "تاریک",
  "common.price": "قیمت",
  "common.area": "متراژ",
  "common.bedrooms": "خوابه",
  "common.bathrooms": "حمام",
  "badges.title": "نشان‌ها",
  "auctions.title": "مزایده‌های ملکی",
  "auctions.subtitle": "بهترین فرصت‌ها را بیابید.",
  "auctions.search": "جستجوی ملک یا مکان...",
  "auctions.filter.all": "همه",
  "auctions.filter.villas": "ویلا",
  "auctions.filter.apartments": "آپارتمان",
  "auctions.filter.lands": "زمین",
  "auctions.section.active": "مزایده‌های فعال",
  "auctions.section.featured": "املاک ویژه",
  "auctions.section.map": "مکان‌های مزایده‌های فعال",
  "auctions.cta.reset": "بازنشانی جستجو",
  "auctions.details.back": "بازگشت به مزایده‌ها",
  "auctions.bid.submit": "ثبت پیشنهاد",
  "auctions.bid.current": "پیشنهاد فعلی",
  "auctions.bid.start": "قیمت شروع",
  "auctions.location": "مکان",
  "auctions.features": "ویژگی‌ها",
  "auctions.history": "سوابق پیشنهادها",
  "auctions.loading": "در حال بارگذاری اطلاعات...",
  "auctions.notfound": "ملک یافت نشد",
  "common.partner.note": "به‌زودی به «مزایده‌های عمان» متصل می‌شود.",
  "partners.title": "شرکای ما",
  "partners.subtitle": "شرکای مورد اعتماد.",
  "partners.search.placeholder": "نام شریک…",
  "partners.category.all": "همه دسته‌ها",
  "partners.category.agency": "آژانس‌ها",
  "partners.category.developer": "توسعه‌دهندگان",
  "partners.category.bank": "مالی",
  "partners.category.service": "خدمات",
  "partners.cta.join": "درخواست پیوستن",
  "partners.empty": "نتیجه‌ای نیست.",
  "invest.title": "سرمایه‌گذاری ملکی",
  "invest.subtitle": "فرصت‌های سنجیده.",
  "invest.filter.all": "همه",
  "invest.filter.reit": "REITs",
  "invest.filter.crowd": "سرمایه‌گذاری جمعی",
  "invest.filter.debt": "بدهی ملکی",
  "invest.card.min": "حداقل",
  "invest.card.roi": "بازده مورد انتظار",
  "invest.card.duration": "مدت",
  "invest.card.location": "مکان",
  "invest.card.learn": "جزئیات",
  "invest.note": "اتصال در آینده.",
  "faq.title": "سوالات متداول",
  "faq.subtitle": "پاسخ‌های سریع.",
  "faq.contact": "نیافتید؟ تماس بگیرید",
  "footer.rights": "© {year} عین عمان. همه حقوق محفوظ.",
  "footer.links.privacy": "حریم خصوصی",
  "footer.links.terms": "شرایط",
  "footer.links.faq": "سوالات",
  "common.active": "فعال",
  "subs.view.paywall": "برای مشاهده جزئیات اشتراک لازم است",
  "subs.required": "فقط مشترکان.",
  "subs.upgrade": "ارتقای طرح",
  "ai.analysis": "تحلیل هوشمند",
};

const ur: Dict = {
  "app.name": "عین عمان",
  "nav.home": "صفحۂ اول",
  "nav.search": "تلاش",
  "nav.properties": "جائیدادیں",
  "nav.auctions": "نیلامیاں",
  "nav.partners": "شراکت دار",
  "nav.invest": "سرمایہ کاری",
  "nav.about": "ہمارے بارے میں",
  "nav.contact": "رابطہ کریں",
  "nav.login": "لاگ اِن",
  "nav.logout": "لاگ آؤٹ",
  "nav.dashboard": "ڈیش بورڈ",
  "common.visit": "ملاحظہ کریں",
  "common.view": "دیکھیں",
  "common.view.details": "تفصیل دیکھیں",
  "common.edit": "ترمیم",
  "common.delete": "حذف کریں",
  "common.back": "واپس",
  "common.next": "اگلا",
  "common.previous": "پچھلا",
  "common.search": "تلاش",
  "common.filter": "فلٹر",
  "common.reset": "ری سیٹ",
  "common.save": "محفوظ کریں",
  "common.publish": "شائع کریں",
  "common.unpublish": "اشاعت ہٹائیں",
  "common.submit": "جمع کرائیں",
  "common.cancel": "منسوخ",
  "common.ok": "ٹھیک ہے",
  "common.yes": "ہاں",
  "common.no": "نہیں",
  "common.apply": "لاگو کریں",
  "common.clear": "صاف کریں",
  "common.location": "مقام",
  "common.remaining": "باقی وقت",
  "common.initial_price": "ابتدائی قیمت",
  "common.current_bid": "موجودہ بولی",
  "common.bid": "بولی لگائیں",
  "common.loading": "لوڈ ہو رہا ہے…",
  "common.loading.properties": "جائیدادیں لوڈ ہورہی ہیں...",
  "common.error": "غیر متوقع خرابی",
  "common.success": "عمل کامیاب",
  "common.print": "پرنٹ",
  "common.preview": "پیش نظارہ",
  "common.language": "زبان",
  "common.theme": "موڈ",
  "common.theme.light": "ہلکا",
  "common.theme.dark": "گہرا",
  "common.price": "قیمت",
  "common.area": "رقبہ",
  "common.bedrooms": "بیڈروم",
  "common.bathrooms": "باتھ روم",
  "badges.title": "بیجز",
  "auctions.title": "ریئل اسٹیٹ نیلامیاں",
  "auctions.subtitle": "بہترین مواقع دریافت کریں۔",
  "auctions.search": "جائیداد یا مقام تلاش کریں...",
  "auctions.filter.all": "سب",
  "auctions.filter.villas": "ولا",
  "auctions.filter.apartments": "اپارٹمنٹس",
  "auctions.filter.lands": "زمینیں",
  "auctions.section.active": "فعال نیلامیاں",
  "auctions.section.featured": "نمایاں جائیدادیں",
  "auctions.section.map": "فعال مقامات",
  "auctions.cta.reset": "تلاش ری سیٹ کریں",
  "auctions.details.back": "نیلامیوں پر واپس جائیں",
  "auctions.bid.submit": "بولی جمع کرائیں",
  "auctions.bid.current": "موجودہ بولی",
  "auctions.bid.start": "ابتدائی قیمت",
  "auctions.location": "مقام",
  "auctions.features": "خصوصیات",
  "auctions.history": "بولی کی تاریخ",
  "auctions.loading": "ڈیٹا لوڈ ہو رہا ہے...",
  "auctions.notfound": "جائیداد نہیں ملی",
  "common.partner.note": "جلد ہی عمان آکشنز سے منسلک ہوگا۔",
  "partners.title": "ہمارے شراکت دار",
  "partners.subtitle": "بااعتماد شراکت دار۔",
  "partners.search.placeholder": "نام تلاش کریں…",
  "partners.category.all": "تمام اقسام",
  "partners.category.agency": "ایجنسیاں",
  "partners.category.developer": "ڈویلپرز",
  "partners.category.bank": "فنانس",
  "partners.category.service": "سروسز",
  "partners.cta.join": "شمولیت کی درخواست",
  "partners.empty": "کوئی نتیجہ نہیں۔",
  "invest.title": "ریئل اسٹیٹ سرمایہ کاری",
  "invest.subtitle": "متوقع منافع اور شفاف انتظام۔",
  "invest.filter.all": "سب",
  "invest.filter.reit": "REITs",
  "invest.filter.crowd": "اشتراکی سرمایہ کاری",
  "invest.filter.debt": "ریئل اسٹیٹ قرض",
  "invest.card.min": "کم از کم",
  "invest.card.roi": "متوقع منافع",
  "invest.card.duration": "مدت",
  "invest.card.location": "مقام",
  "invest.card.learn": "تفصیل",
  "invest.note": "آئندہ ربط ہوگا۔",
  "faq.title": "عمومی سوالات",
  "faq.subtitle": "جلد جواب.",
  "faq.contact": "جواب نہیں ملا؟ رابطہ کریں",
  "footer.rights": "© {year} عین عمان۔ حقوق محفوظ۔",
  "footer.links.privacy": "پرائیویسی پالیسی",
  "footer.links.terms": "شرائط و ضوابط",
  "footer.links.faq": "عمومی سوالات",
  "common.active": "فعال",
  "subs.view.paywall": "تفصیل دیکھنے کے لیے رکنیت درکار",
  "subs.required": "یہ فیچر صرف اراکین کے لیے۔",
  "subs.upgrade": "پلان اَپ گریڈ",
  "ai.analysis": "اے آئی تجزیہ",
};

const DICTS: Bundle = { ar, en, fr, hi, fa, ur };

// ————— أدوات —————
const isBrowser = () => typeof window !== "undefined" && typeof document !== "undefined";
const normLang = (input?: string | null): Lang => {
  const raw = (input || "").toLowerCase().trim();
  const primary = (raw.split("-")[0] || "") as Lang;
  return SUPPORTED.includes(primary) ? primary : "ar";
};
const getUrlLang = (): Lang | null => {
  if (!isBrowser()) return null;
  const p = new URLSearchParams(window.location.search).get("lang");
  return p ? normLang(p) : null;
};
const guessInitialLang = (): Lang => {
  const fromUrl = getUrlLang();
  if (fromUrl) return fromUrl;
  if (isBrowser()) {
    const saved = localStorage.getItem("lang");
    if (saved) return normLang(saved);
    const htmlL = document.documentElement.getAttribute("lang");
    if (htmlL) return normLang(htmlL);
    const nav = (navigator as any).language || (((navigator as any).languages || [])[0] as string | undefined) || "";
    if (nav) return normLang(nav);
  }
  return "ar";
};
export const getDir = (l: string | Lang): "rtl" | "ltr" =>
  RTL_LANGS.includes(normLang(l)) ? "rtl" : "ltr";

function applyHtml(lang: Lang) {
  if (!isBrowser()) return;
  document.documentElement.setAttribute("lang", lang);
  document.documentElement.setAttribute("dir", getDir(lang));
  document.body.classList.toggle("rtl", RTL_LANGS.includes(lang));
}

function translate(lang: Lang, key: string, fallback?: string, vars?: Record<string, string | number>) {
  const d = DICTS[lang] || DICTS.en || {};
  let s = d[key] ?? DICTS.en?.[key] ?? DICTS.ar?.[key] ?? (fallback ?? key);
  if (vars) {
    for (const [vk, vv] of Object.entries(vars)) s = s.split(`{${vk}}`).join(String(vv));
  }
  return s;
}

// ————— getT للتوافق —————
export function getT(router?: { locale?: string } | string | null) {
  let lang: Lang = "ar";
  if (typeof router === "string") lang = normLang(router);
  else if (router && typeof router === "object" && "locale" in router) lang = normLang(router.locale || "");
  else {
    const fromUrl = getUrlLang();
    lang = fromUrl || (isBrowser() ? normLang(localStorage.getItem("lang")) : "ar") || "ar";
  }
  return (k: string, fallback?: string | Record<string, string | number>, vars?: Record<string, string | number>) => {
    if (fallback && typeof fallback === 'object') return translate(lang, k, undefined, fallback);
    return translate(lang, k, typeof fallback === 'string' ? fallback : undefined, vars);
  };
}

// ————— Context API —————
type I18nCtx = {
  t: (k: string, fallback?: string | Record<string, string | number>, vars?: Record<string, string | number>) => string;
  lang: Lang;
  dir: "rtl" | "ltr";
  setLang: (l: Lang) => void;
  supported: Lang[];
};

const I18nContext = createContext<I18nCtx | null>(null);

export function I18nProvider({ children, initialLang }: { children: React.ReactNode; initialLang?: Lang }) {
  const [lang, setLangState] = useState<Lang>(initialLang ?? guessInitialLang());

  useEffect(() => {
    applyHtml(lang);
    if (isBrowser()) try { localStorage.setItem("lang", lang); } catch {}
  }, [lang]);

  const t = useMemo(() => (k: string, fallback?: string | Record<string, string | number>, vars?: Record<string, string | number>) => {
    if (fallback && typeof fallback === 'object') return translate(lang, k, undefined, fallback);
    return translate(lang, k, typeof fallback === 'string' ? fallback : undefined, vars);
  }, [lang]);
  const setLang = (l: Lang) => setLangState(normLang(l));
  const value: I18nCtx = { t, lang, dir: getDir(lang), setLang, supported: SUPPORTED };

  return React.createElement(I18nContext.Provider, { value }, children);
}

export function useI18n() {
  const ctx = useContext(I18nContext);
  if (!ctx) throw new Error("useI18n must be used within I18nProvider.");
  return ctx;
}

// أسماء بديلة للتوافق
export const LanguageProvider = I18nProvider;
export const SUPPORTED_LANGS = SUPPORTED;
export const IS_RTL = (l: Lang) => RTL_LANGS.includes(l);
